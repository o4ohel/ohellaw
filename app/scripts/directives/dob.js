'use strict';

/**
 * @ngdoc directive
 * @name ohellawApp.directive:dob
 * @description
 * # dob
 */
angular.module('ohellawApp').directive('dob', function () {
  return {
    templateUrl: 'views/dobTpl.html',
    restrict: 'E',
    scope: {
      dob: '='
    },
    link: function (scope, element, attrs) {
      var now = new Date(),
        thisYear = now.getFullYear(),
        months = [
          {key: '01', label: 'Jan'},
          {key: '02', label: 'Feb'},
          {key: '03', label: 'Mar'},
          {key: '04', label: 'Apr'},
          {key: '05', label: 'May'},
          {key: '06', label: 'Jun'},
          {key: '07', label: 'Jul'},
          {key: '08', label: 'Aug'},
          {key: '09', label: 'Sep'},
          {key: '10', label: 'Oct'},
          {key: '11', label: 'Nov'},
          {key: '11', label: 'Dec'}

        ],
        days = {
          '01': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'],
          '02': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29'],
          '03': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'],
          '04': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30'],
          '05': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'],
          '06': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30'],
          '07': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'],
          '08': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'],
          '09': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30'],
          '10': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'],
          '11': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30'],
          '12': ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15',
                '16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31']
        }
      ;

      function getYears(thisYear) {
        var years = [thisYear], i = 0, len = 100;
        for(i = 1; i < 100; i++) {
          years.push(thisYear - i);
        }
        return years;
      }

      scope.months = months;
      scope.days = days;
      scope.years = getYears(thisYear);
      scope._dob = {
        month: months[0],
        day: '01',
        year: thisYear
      };

      scope.$watchCollection('_dob', function(d) {
        //TODO: update the dob from the outside controller
        
        console.log(d);
      });

      scope.maxYear = thisYear;
      scope.minYear = thisYear - 100;
    }
  };
});
